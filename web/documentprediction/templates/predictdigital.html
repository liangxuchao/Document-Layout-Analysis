
{% extends 'layout.html' %} 
{% block body %}


        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
          <h1 class="h2">Predict Digital Document</h1>
          
        </div>


        {% comment %} <h6>Current Setting</h6>
        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>Predict Document Threshold</th>
                <th>Predict Layout Threshold</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{config.PredDocumentThreshold}}</td>
                <td>{{config.PredLayoutThreshold}}</td>
              </tr>
             
             
            </tbody>
          </table>
        </div> {% endcomment %}
        <h6>Upload Image File For Prediction</h6>
        <form  id="uploadimgform"  enctype="multipart/form-data">
            {% csrf_token %}
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="customFile"  name="files[]" multiple="multiple">
              <label class="custom-file-label" for="customFile">Choose file</label>
            </div>
            <div class="mt-3">
                <button type="submit" class="btn btn-primary">Submit</button>
              </div>
          </form>
        <h6>Image Pending To Predict</h6>
        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>Filename</th>
              </tr>
            </thead>
            <tbody>
            
            {% for i in predimglist %}
              <tr>
                <td width="50%">{{i.0}}</td>
                <td><img width="400px" src="data:image/png;base64,{{i.1}}" /></td>
              </tr>
             {%endfor%}
             
         
           
            </tbody>
          </table>


        </div>
     
    <div class="mt-3">
                    <button type="buton" class="btn btn-primary" id="apredict" onclick="apredict();">Start Prediction</button>
                    <button class="btn btn-primary" type="button" id="apredictwaiting" disabled style="display:none;">
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Predicting...
                      </button>
                  </div>
                  <hr/>
                  <h6>Predict Results</h6>
                  <div class="table-responsive">
                    <table class="table table-striped table-sm">
                      <thead>
                        <tr>
                     
                          <th>Predict Layout</th>
                        </tr>
                      </thead>
                      <tbody id='predicresult'>
                       
                      
                       
                       
                      </tbody>
                    </table>
                  </div>       
       
{% endblock body %}


{% block javascript %}
<script>

    // Add the following code if you want the name of the file appear on select
$(".custom-file-input").on("change", function() {
    var fileName = $(this).val().split("\\").pop();
    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
  });

  $(document).ready(function () {
    $("#uploadimgform").submit(function (e) {
        console.log('submit')
        e.preventDefault();   
        var formData = new FormData()
        formData.append("csrfmiddlewaretoken", '{{ csrf_token }}')
        formData.append("type", 'digital')
        var ins = document.getElementById('customFile').files.length;
		
        for (var x = 0; x < ins; x++) {
            formData.append("files[]", document.getElementById('customFile').files[x]);
        }

        $.ajax({
            type: 'POST',
            enctype: 'multipart/form-data',
            processData: false,  // Important!
            contentType: false,
            
            url: "{% url 'uploadtestimg' %}",
            data: formData,
            success: function (response) {
                // on successfull creating object
                // 1. clear the form.
               alert("Image uploaded")
               location.reload();
            },
            error: function (response) {
                // alert the error if any error occured
               console.log(response)
            }
        })
    });
  });

  function apredict(){
    $("#apredict").attr("disabled", true);
    $("#apredict").attr("style", "display:none;");
    $("#apredictwaiting").attr("style", "display:block;");
    $.ajax({
        type: 'POST',
        csrfmiddlewaretoken: '{{ csrf_token }}',
        url: "{% url 'apredict' %}",
        data:{"csrfmiddlewaretoken": '{{ csrf_token }}','type':'digital'},
        success: function (response) {
            // on successfull creating object
            // 1. clear the form.
           alert("Finish Prediction")
           $("#predicresult").html("")
           for(var i =0; i<response["returnlayoutimgs"].length;i++){

            console.log(response["returnlayoutimgs"][i])
            tr = "<tr><td >" +'<img style="width:50%" src="data:image/png;base64,'+  response["returnlayoutimgs"][i] +'">' +"</td></tr>"
            $("#predicresult").append(tr)
           }
        $("#apredict").attr("disabled", false);
        $("#apredict").attr("style", "display:block;");
        $("#apredictwaiting").attr("style", "display:none;");
        },
        error: function (response) {
            // alert the error if any error occured
           console.log(response)
        }
    })
  }

  $('#loading-image').bind('ajaxStart', function(){
    $(this).show();
}).bind('ajaxStop', function(){
    $(this).hide();
});
</script>
{% endblock javascript %}